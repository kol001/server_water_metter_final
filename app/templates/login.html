<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Connexion</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --card-w: 420px;
      --radius: 16px;
      --primary:#5468ff;
      --primary-pressed:#4554d6;
      --text:#0f172a;
      --muted:#6b7280;
      --input:#f4f6fb;
      --ring:#e6e9f7;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,Arial,sans-serif;
      color:var(--text);
      display:flex;align-items:center;justify-content:center;
      padding:24px;
      background:
        radial-gradient(1200px 600px at 10% 10%, #86b6ff 0%, rgba(134,182,255,0) 60%),
        radial-gradient(1200px 700px at 80% 30%, #b38bff 0%, rgba(179,139,255,0) 65%),
        radial-gradient(900px 500px at 60% 90%, #b4e0ff 0%, rgba(180,224,255,0) 55%),
        linear-gradient(180deg, #f6f7ff 0%, #e9edff 100%);
    }
    .card{
      width:min(100%,var(--card-w));
      background:#ffffffcc; backdrop-filter:blur(6px);
      border-radius:var(--radius);
      box-shadow:0 10px 30px rgba(16,24,40,.08),0 2px 6px rgba(16,24,40,.06);
      padding:56px;
    }
    .brand{display:flex;justify-content:center;align-items:center;gap:8px;margin-bottom:6px;font-weight:700}
    .brand svg{width:20px;height:20px}
    .title{ text-align:center; margin:8px 0 4px; font-size:20px; font-weight:700;}
    .subtitle{ text-align:center; margin:0 0 18px; color:var(--muted); font-size:13px;}
    .form-group{ margin-bottom:12px;}
    .label{ display:block; font-size:12px; font-weight:600; margin:0 0 6px;}
    .input{
      display:flex; align-items:center; gap:8px;
      background:var(--input); border:1px solid var(--ring);
      border-radius:10px; padding:12px 12px; transition:box-shadow .15s,border-color .15s,background .15s;
    }
    .input:focus-within{ border-color:#c9d1ff; box-shadow:0 0 0 3px #e9ecff; background:#fff; }
    .input input{ width:100%; border:0; outline:0; background:transparent; font-size:14px; }
    .password-toggle{ background:none;border:0;cursor:pointer;opacity:.7;display:flex;align-items:center }
    .password-toggle:hover{opacity:1}
    .row{ display:flex; align-items:center; justify-content:space-between; margin:6px 0 12px; font-size:13px;}
    .checkbox{ display:flex; align-items:center; gap:8px;}
    .checkbox input{ width:16px; height:16px; accent-color:var(--primary); }
    .link{ color:var(--primary); text-decoration:none; font-weight:600;}
    .link:hover{ text-decoration:underline; }
    .btn{
      width:100%; border:0; border-radius:12px; padding:12px 14px;
      font-weight:600; cursor:pointer; transition:transform .04s, background .15s;
      background:var(--primary); color:#fff;
    }
    .btn:hover{ background:var(--primary-pressed); }
    .btn:active{ transform:translateY(1px); }
    .error{
      color:#b91c1c; background:#fee2e2; border:1px solid #fecaca;
      padding:8px 10px; border-radius:10px; font-size:13px; margin-top:10px; display:none;
    }
    .foot{ text-align:center; font-size:13px; color:var(--muted); margin-top:14px;}
    @media (max-width:380px){ .card{padding:22px} }
  </style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="titre">
    <!-- <div class="brand">
      <svg viewBox="0 0 24 24" fill="none"><path d="M12 3l7 4v10l-7 4-7-4V7l7-4z" stroke="#5468ff" stroke-width="2"/><circle cx="12" cy="12" r="2" fill="#5468ff"/></svg>
      <span>PEPPO</span>
    </div> -->

    <h1 id="titre" class="title">Bienvenue!</h1>
    <p class="subtitle">Veuillez vous connecter pour continuer.</p>
    <br>
    <br>

    <form id="loginForm" novalidate>
      <div class="form-group">
        <label class="label" for="username">Nom</label>
        <div class="input">
          <input type="text" id="username" name="username" placeholder="Enter your email" required />
        </div>
      </div>

      <div class="form-group">
        <label class="label" for="password">Password</label>
        <div class="input">
          <input type="password" id="password" name="password" placeholder="Enter your password" required />
          <button class="password-toggle" type="button" aria-label="Afficher le mot de passe" onclick="togglePwd()">
            <svg id="eyeIcon" viewBox="0 0 24 24" fill="none" width="18" height="18">
              <path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12z" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="row">
        <label class="checkbox">
          <input type="checkbox" id="remember" />
          <span>Se souvenir de moi</span>
        </label>
        <!-- Si pas dispo, commente la ligne ci-dessous -->
        <!-- <a class="link" href="#" onclick="return false;">Forgot password?</a> -->
      </div>

      <button class="btn" type="submit">Se connecter</button>

      <p id="errorMessage" class="error" role="alert"></p>

      <!-- Si l’inscription n’est pas prête, commente aussi ceci -->
      <!-- <p class="foot">Don’t have an account? <a class="link" href="#" onclick="return false;">Sign up</a></p> -->
    </form>
  </main>

  <script>
    function togglePwd(){
      const input = document.getElementById('password');
      const eye = document.getElementById('eyeIcon');
      const isPwd = input.type === 'password';
      input.type = isPwd ? 'text' : 'password';
      eye.innerHTML = isPwd
        ? '<path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12z" stroke="currentColor" stroke-width="2"/><path d="M4 4l16 16" stroke="currentColor" stroke-width="2"/>'
        : '<path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12z" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>';
    }

    // Ton JS de connexion inchangé
    document.getElementById('loginForm').addEventListener('submit', async function(event) {
      event.preventDefault();
      const form = event.target;
      const formData = new FormData(form);
      const data = {
        username: formData.get('username'),
        password: formData.get('password')
      };
      try {
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await response.json();
        const errorMessage = document.getElementById('errorMessage');

        if (response.ok && result.token) {
          localStorage.setItem('jwt_token', result.token);
          window.location.href = '/';
        } else {
          errorMessage.textContent = result.error || 'Erreur lors de la connexion';
          errorMessage.style.display = 'block';
        }
      } catch (error) {
        const errorMessage = document.getElementById('errorMessage');
        errorMessage.textContent = "Erreur lors de l'envoi : " + error.message;
        errorMessage.style.display = 'block';
      }
    });
  </script>
</body>
</html>
